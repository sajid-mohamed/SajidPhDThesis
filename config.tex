% The style file
% Contains settings, macro definitions and package inclusions
%

\usepackage{anyfontsize}
%Personal names etc.
\newcommand{\myTerm}{myTerm} %Example of a term you use often. Prevent typos, use macros!

%Normal text abbreviations
\newcommand{\ie}{i.e.\xspace}
\newcommand{\Ie}{I.e.\xspace}
\newcommand{\eg}{e.g.\xspace}
\newcommand{\Eg}{E.g.\xspace}
\newcommand{\vs}{v.s.\xspace}
\newcommand{\etc}{etc.\xspace}

\newcommand\hmmax{0}
\newcommand\bmmax{0}
% needed to not throw "LaTeX Error: Too many math alphabets used in version normal."

\newcommand{\etal}{et al.\xspace}
\newcommand{\cf}{cf.\xspace}

\usepackage{lmodern}

% footnote without marker, to put a note on the chapters from which papers they arose
\newcommand\blfootnote[1]{%
    \begingroup
    \renewcommand\thefootnote{}\footnote{#1}%
    \addtocounter{footnote}{-1}%
    \endgroup
}
%EXTEND when/if necessary

%This one needs/wants/has to be first
\usepackage[dvipsnames,table]{xcolor} % [dvipsnames]
\definecolor{darkred}{rgb}{0.5,0,0}
\definecolor{darkgreen}{rgb}{0,0.5,0}
\definecolor{darkblue}{rgb}{0,0,0.5}
\definecolor{halfgray}{gray}{0.55} % chapter numbers will be semi transparent .5 .55 .6 .0
\definecolor{webgreen}{rgb}{0,.5,0}
\definecolor{webbrown}{rgb}{.6,0,0}
%define your own colors, also to easily change them all at once

% ********************************************************************
% Setup, finetuning, and useful commands
% ********************************************************************
\newcounter{dummy} % necessary for correct hyperlinks (to index, bib, etc.)
\newlength{\abcd} % for ab..z string length calculation
\providecommand{\mLyX}{L\kern-.1667em\lower.25em\hbox{Y}\kern-.125emX\@}
% ****************************************************************************************************

%---------------------------------------%
% Default fig and table positioning     %
%---------------------------------------%

% From http://tex.stackexchange.com/questions/140568/how-to-set-default-positioning-of-figure-table-document-wide (BY MOI :D)
% and http://tex.stackexchange.com/questions/8351/what-do-makeatletter-and-makeatother-do
\makeatletter
  \providecommand*\setfloatlocations[2]{\@namedef{fps@#1}{#2}}
\makeatother
\setfloatlocations{figure}{b!}
\setfloatlocations{table}{t!}
%\setfloatlocations{subfigure}{t} %does not seem to work the same as adding [t] to begin{subfigure}

%
% Footnote command that has no marker or counter increase
% FROM http://en.wikibooks.org/wiki/LaTeX/Footnotes_and_Margin_Notes
%
\makeatletter
\def\blfootnote{\xdef\@thefnmark{}\@footnotetext}
\makeatother


% ****************************************************************************************************
% 3. Loading some handy packages (alphabetically mainly)
% ****************************************************************************************************

%might be disabled:
\listfiles %include list of used files in .log

\usepackage[fleqn]{amsmath}   % math environments and more by the AMS
\usepackage[paperwidth=17cm,paperheight=24cm, textheight=526pt,marginpar=2cm]{geometry}

% ----------Size of the paper and the margins----------------
%\RequirePackage[paperwidth=17cm, paperheight=24cm, textwidth=12.8cm, textheight = 19.5cm, top=2.5cm, inner=2.2cm, outer=2cm, bottom=2cm]{geometry}

%Use crop package below to place cutlines in the document

%\usepackage[cross,width=17.2cm,height=24.2cm,center]{crop}

\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\dom}{dom}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\vect}[1]{\boldsymbol{#1}}

\usepackage{amsthm}
%\newtheorem{definition}{Definition}[chapter]  %We use mainly definitions and number them by chapter
\newtheorem{definition}{Definition}
\newtheorem{proposition}{Proposition}

\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
\usepackage{algorithmic}
\usepackage{amssymb,dsfont}        % f.i. the circular arrows
\usepackage{import} 
\usepackage[dutch,english]{babel} %we need Dutch too, but main text is english so load english last
\usepackage{booktabs}       % for better rules in tables
\usepackage{bm}             % for bold math (eg numbers), still looks kinda ugly
\usepackage{bibentry}       % Inline bibliography entries
\nobibliography*

\usepackage[toc,page]{appendix}
% allow 3-digit page numbers to be rendered properly
\makeatletter
\renewcommand{\@pnumwidth}{2em} 
%\renewcommand{\@tocrmarg}{4em}
\makeatother
\setcounter{tocdepth}{1}
\usepackage{tocvsec2}

\usepackage{calc}           % Calculations, mainly coordinates in TikZ

\usepackage{caption}        % for better captions...
\captionsetup{format=hang,font=small}

\usepackage{cite}           % for neat citations (\eg sorted and abbreviated to 1-20)
\usepackage{comment}        % add a comment environment

\usepackage{datetime}   % time access (mainly for page footer)
\yyyymmdddate
\usepackage{doi}            % provides the \doi{} command that makes DOIs into hyperlinks (not needed if biblatex is enabled I guess)
%\usepackage{dsfont}         % For natural numbers symbol etc.
\usepackage{emptypage}      % Empty pages between chapters!!!!

%Fancy headers!!!
\usepackage{fancyhdr}
\usepackage[Lenny]{fncychap} %We chooose lenny, refer to package doc for more styles
\pagestyle{fancy}
%For more setup see below
\usepackage{mathpazo,tgpagella,tgadventor}
%\linespread{1.05}         % Palladio needs more leading (space between lines)
\usepackage[T1]{fontenc}% T2a for cyrillics (http://tex.stackexchange.com/questions/664/why-should-i-use-usepackaget1fontenc)
\usepackage{fourier}        %For better math font style (tip by Jack van Wijk)
\usepackage{csvsimple}
\usepackage{graphicx}       % Graphics (only text is booooring)
\graphicspath{{./Figures/}} % Which we load from a subdir
\usepackage{array}
%\usepackage[xindy,toc]{glossaries}  
\usepackage[xindy,acronym,nomain,smallcaps,toc]{glossaries} % sorted glossary entries
\input{acronyms.tex}

\usepackage{hhline}         % for more specific lines in tables
\usepackage{hyphenat}
%\hyphenation{re-cor-ded re-quire-ments}    % These words were not hyphenated correctly automatically but are now! Extend as necessary
\hyphenation{other-wise}
%\usepackage[latin9]{inputenc}
\usepackage[utf8]{inputenc}  % To prevent 'ï»¿' etc. to appear. 'latin9' is default (I guess) and 'utf8' fails on some 'no-break space' characters which are hard to find...

\usepackage{lastpage}       % To be able to say how many pages we have
\usepackage{lipsum}         % To add some of these fake text we do, you should be able to delete this when your thesis is done! really! Not kidding...
\usepackage{longtable}      % For multi-page tables

\usepackage{makeidx}        % For creating an index which every proper book should have %NOTE: should be loaded before hyperref
%\usepackage{showidx}        % Show index keys in the margin (is not on good terms with hyperref so do NOT enable)
\usepackage{mathtools}      % mathtools builds on and extends amsmath package, used to break long equations over multiple lines in ch. 6
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

\newcommand{\asap}[1]{\ensuremath{\underline{#1}}}
\newcommand{\alap}[1]{\ensuremath{\overline{#1}}}

\usepackage{mparhack}       % get marginpar right (known bug)
\usepackage{multirow}       % multiple rows and columns in tables

\usepackage{paralist}       % for inline lists
%\usepackage{pdflscape}      % land scape pages
\usepackage{lscape}
\usepackage{pdfpages}
\usepackage{pifont}         % For the \ding command (used for \tick, \cross, etc.)
\usepackage{placeins}       % Introduces the \FloatBarrier command, but can also be set to never let floats cross section boundaries
\usepackage[draft]{prelim2e}       %Mark prelimenary versions by adding [draft]
\renewcommand{\PrelimWords}{\relax}
\renewcommand{\PrelimText}{\footnotesize[\,\today\ at \currenttime\ -- \pageref{LastPage} pages -- \myVersion\,]} \renewcommand{\PrelimText}{} %Clears the footer all together

\usepackage[inline]{enumitem}
\usepackage{float}
\usepackage{rotating}       % For rotating in tables from Excel (using Excel plug-in)
\usepackage{standalone}     % To make the individual TikZ files also compilable :)

\usepackage{tabularx}       % for vertical alignment in tables
\usepackage[nottoc]{tocbibind}      % We want the bibliography in the TOC please!

%I L-O-V-E TikZ!
\input{config-TikZ}

\usepackage[colorinlistoftodos,backgroundcolor=white,linecolor=gray]{todonotes}  %More advanced todos, default todo has no color
%And different predefined todos (change as you see fit)
%\newcommand{\RW}[1][]{\todo[color=green!40]{RW: #1}}
\newcommand{\atProf}[1]{\todo[color=blue!40]{@W: #1}}
\newcommand{\status}[1]{\todo[color=purple!40]{STATUS: #1}}

\newcommand{\should}[1]{\todo[color=red!40]{#1}}  % 'must do' todos
\newcommand{\could}[1]{\todo[color=orange!40]{#1}}   % easy improvement todos
\newcommand{\would}[1]{\todo[color=yellow!40]{#1}}   % suggestions
\newcommand{\may}[1]{\todo{#1}}     % maybe...

\newcommand{\forFinal}[1]{\todo[color=brown!40]{#1}} %Action points before final version is created

\usepackage{todonotes}
\newif\iftodoused
\newcommand{\todosajid}[2][]
{\iftodoused\todo[inline, color=green!20, #1]{\small\textbf{Sajid: }#2}\fi}
\newcommand{\todotwan}[2][]
{\iftodoused\todo[inline, color=pink!20, #1]{\small\textbf{Twan: }#2}\fi}
\newcommand{\tododip}[2][]
{\iftodoused\todo[inline, color=orange!20, #1]{\small\textbf{Dip: }#2}\fi}

\renewcommand{\arraystretch}{1.2}
%%%%%TO TURN TODO NOTES ON/OFF ::::
%
\renewcommand{\todo}[2][]{}

\usepackage{wasysym}        % For the correct sized circle inside the BPMN gateways...

\usepackage{xspace}         %To add space to command definitions


%\usepackage{fixltx2e} % fixes some LaTeX stuff
\usepackage{textcomp} % fix warning with missing font shapes

% PDFLaTeX, hyperreferences and citation backreferences
% ****************************************************************************************************
% PDFLaTeX
% ocgcolorlinks : ensures that colored links are printed as black (when supported by PDF viewer!) (from http://tex.stackexchange.com/questions/4425/is-there-a-way-to-have-coloured-hyperref-hyperlinks-in-the-pdf-but-have-them-pr)
% NOTE: ocgcolorlinks does not seem to work for me, so made all links black!
\PassOptionsToPackage{hidelinks,pdftex,hyperfootnotes=false,pdfpagelabels,ocgcolorlinks,pdfpagelayout=TwoPageRight,utf8}{hyperref}
\PassOptionsToPackage{hyphens,sloppy}{url}
\RequirePackage{hyperref}
\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother
\pdfcatalog{/PageLayout /TwoPageRight}
% ********************************************************************
% Setup the style of the backrefs from the bibliography
% ********************************************************************

% disable when using biblatex!!!
\newcommand{\backrefnotcitedstring}{\relax}%(Not cited.)
\newcommand{\backrefcitedsinglestring}[1]{(Cited on page~#1.)}
\newcommand{\backrefcitedmultistring}[1]{(Cited on pages~#1.)}
		\PassOptionsToPackage{hyperpageref}{backref}
\usepackage[hyperpageref]{backref} % to be loaded after hyperref package
   \renewcommand{\backreftwosep}{ and~} % separate 2 pages
   \renewcommand{\backreflastsep}{, and~} % separate last of longer list
   \renewcommand*{\backref}[1]{}  % disable standard
   \renewcommand*{\backrefalt}[4]{% detailed backref
      \ifcase #1 %
         \backrefnotcitedstring%
      \or%
         \backrefcitedsinglestring{#2}%
      \else%
         \backrefcitedmultistring{#2}%
      \fi}%

% ********************************************************************
% Hyperreferences
% ********************************************************************
\hypersetup{%
%    draft,	% = no hyperlinking at all (useful in b/w printouts)
    colorlinks=false,
%     hidelinks=true,
%    colorlinks=true,
    linktocpage=true, pdfstartpage=3, pdfstartview=FitV,%
    % uncomment the following line if you want to have black links (\eg, for printing)
    colorlinks=false, linktocpage=false, pdfborder={0 0 0}, pdfstartpage=3, pdfstartview=FitV,%
    linktoc=all, %make whole line in TOC clickable
    breaklinks=true, pdfpagemode=UseNone, pageanchor=true, pdfpagemode=UseOutlines,%
    plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=1,%
    hypertexnames=true, pdfhighlight=/O,%nesting=true,%frenchlinks,%
    urlcolor=webbrown, linkcolor=RoyalBlue, citecolor=webgreen, %pagecolor=RoyalBlue,%
    %urlcolor=Black, linkcolor=Black, citecolor=Black, %pagecolor=Black,%
    pdftitle={\myTitle},%
    pdfauthor={\textcopyright\ \myName, \myUni, \myFaculty},%
    pdfsubject={},%
    pdfkeywords={\myKeywords},%
    pdfcreator={pdfLaTeX},%
    pdfproducer={LaTeX with hyperref}
}

\usepackage[percent]{overpic}
%Correct autoref names
\makeatletter
\addto\extrasenglish{
\renewcommand*{\figureautorefname}{Figure}%
\renewcommand*{\tableautorefname}{Table}%
\renewcommand*{\partautorefname}{Part}%
\renewcommand*{\chapterautorefname}{Chapter}%
\renewcommand*{\sectionautorefname}{Section}%
\renewcommand*{\subsectionautorefname}{Section}%
\renewcommand*{\subsubsectionautorefname}{Section}% 	
\providecommand{\subfigureautorefname}{\figureautorefname}%
\providecommand{\definitionautorefname}{Definition} % It's that easy!: http://tex.stackexchange.com/questions/46258/how-to-get-correct-autoref-for-theorems
}
%\RequirePackage[l2tabu, orthodox]{nag}
\makeatother

% for the chapter blocks on the sides
\usepackage{tikzpagenodes}
\usepackage{totcount}
\usepackage[contents={},opacity=1,scale=1,color=white]{background}
%
% Fancy Headers!!!
%

%Lesli Lamports LaTeX book style headers, from fancyhdr manual page 13
\fancyheadoffset[LE,RO]{\marginparsep+\marginparwidth}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}
\fancyhf{}
\fancyhead[LE,RO]{\bfseries\thepage}
\fancyhead[LO]{\bfseries\rightmark}
\fancyhead[RE]{\bfseries\leftmark}
\fancypagestyle{plain}{%
 \fancyhead{} % get rid of headers
 \renewcommand{\headrulewidth}{0pt} % and the line
 \renewcommand{\chaptermark}[1]{\markboth{}}
}
% Creates a page footer with page number at the centre
\fancypagestyle{plain}{%
\fancyhf{}% clear all header and footer fields
\fancyfoot[C]{\textbf{\thepage}} % except the center
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{0pt}%
\renewcommand{\footskip}{50pt}
}

\newif\ifwebversion
\webversiontrue
%\usepackage{showframe}
\ifwebversion
\else
\usepackage[width=17.6cm,height=24.6cm,cam,center]{crop}
\fi

\usepackage{background}

\newif\ifMaterial

\newlength\LabelSize
\setlength\LabelSize{1cm}

\AtBeginDocument{%
    \regtotcounter{chapter}%
}
\newcommand\AddChapterBoxes{%
    \Materialtrue
    \AddEverypageHook{%
        \ifx\@chapapp\appendixname%
        \relax%
        \else%
        \ifMaterial%
        \ifodd\value{page}%
        \backgroundsetup{
            angle=0,
            position={current page.east|-current page text area.north east},
            vshift=-30-(\thechapter-1)*1.5*\LabelSize,
            hshift=-10,
            contents={%
                \tikz\node[ch label, inner xsep=\LabelSize/2] {\hspace*{-\LabelSize}\bfseries{\thechapter}};
            }%
        }%
        \else%
        \backgroundsetup{
            angle=0,
            position={current page.west|-current page text area.north west},
            vshift=-30-(\thechapter-1)*1.5*\LabelSize,
            hshift=10,
            contents={%
                \tikz\node[ch label, inner xsep=\LabelSize/2]{\color{white}\bfseries{\thechapter}\hspace*{-\LabelSize}}; % without the \color{white}, the position is not correct yet! not centered to the left half of the block for some reason...
            }%
        }%
        \fi%
        \BgMaterial%
        \else\relax\fi%
        \fi%
    }%
}

\tikzset{
    ch label/.style={fill=black,anchor=west,text width=\LabelSize, align=center,minimum height=\LabelSize,minimum width=\LabelSize*2,inner sep=+0pt,rounded corners=0.25cm,text=white,font=\sffamily\fontsize{15pt}{0pt}\selectfont},
}

\makeatletter

\ChNumVar{\fontsize{36}{80}\usefont{OT1}{pag}{m}{n}\selectfont}
\renewcommand{\DOCH}{%
%Horizontal line left top
    \settowidth{\px}{\CNV\FmN{\@chapapp}}
    \addtolength{\px}{2pt}

%Horizontal line top
    \setlength{\py}{0pt}
    \setlength{\mylen}{0pt}

    \settowidth{\pxx}{\CNoV\thechapter}
    \addtolength{\pxx}{-1pt}
    \par
    \parbox[b]{\textwidth}{%
    \raggedright%
    \color{red}
    \CNoV
%\FmN{\@chapapp}
    \hskip1pt%
    \thechapter%
    \hskip1pt%
    \color{black}
    \rule{\RW}{\pyy}\par\nobreak%
    \vskip -\baselineskip%
    \vskip -\pyy%
    \hskip \mylen%
    \vskip \pyy}%
    \vskip 20\p@}

\renewcommand{\DOTI}[1]{%
    \raggedright
    \CTV\FmTi{#1}\par\nobreak
    \vskip 40\p@}

  \renewcommand{\DOTIS}[1]{%
    \raggedright
    \CTV\FmTi{#1}\par\nobreak
    \vskip 40\p@}

\makeatother

\usepackage[explicit]{titlesec}
\usepackage{nextpage}
\usepackage{ifoddpage}

\usepackage{thm-restate}

\usepackage{etoolbox}

\usepackage[shortcuts]{extdash}
\makeglossaries
\usepackage{hyperref}
%\usepackage{cleverref}
\usepackage{wrapfig}
\usepackage{threeparttable}
\usepackage{textcomp}
\usepackage{setspace}
\usepackage{stackengine}
\newcommand\textsub[1]{\stackengine{-.5ex}{}{\scriptsize#1}{O}{l}{F}{F}{L}}

%%% Infrastructure    
\makeatletter
\newcommand{\refcheckize}[1]{%
  \expandafter\let\csname @@\string#1\endcsname#1%
  \expandafter\DeclareRobustCommand\csname relax\string#1\endcsname[1]{%
    \csname @@\string#1\endcsname{##1}\@for\@temp:=##1\do{\wrtusdrf{\@temp}\wrtusdrf{{\@temp}}}}%
  \expandafter\let\expandafter#1\csname relax\string#1\endcsname
}
\newcommand{\refcheckizetwo}[1]{%
  \expandafter\let\csname @@\string#1\endcsname#1%
  \expandafter\DeclareRobustCommand\csname relax\string#1\endcsname[2]{%
    \csname @@\string#1\endcsname{##1}{##2}\wrtusdrf{##1}\wrtusdrf{{##1}}\wrtusdrf{##2}\wrtusdrf{{##2}}}%
  \expandafter\let\expandafter#1\csname relax\string#1\endcsname
}
\makeatother

\refcheckize{\cref}
\refcheckize{\Cref}
%\refcheckize{\eqref}
\refcheckizetwo{\crefrange}
\refcheckizetwo{\Crefrange}

%********************************************************
%% Sections
% \newtheorem{algorithm}[theorem]{Algorithm}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{claim}[theorem]{Claim}
\newtheorem{comments}[theorem]{Comments}
\newtheorem{construction}[theorem]{Construction}
\newtheorem{corollary}[theorem]{Corollary}
%\newtheorem{definition}{Definition}
% \newtheorem{definition}[theorem]{\textbf{Definition}}
%\newtheorem{definition}{Definition}[chapter]  %We use mainly definitions and number them by chapter
\newtheorem{example}[theorem]{Example}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{problem}[theorem]{Problem}
%\newtheorem{proposition}{Proposition}
% \newtheorem{proposition}[theorem]{Proposition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{xca}[theorem]{Exercise}
